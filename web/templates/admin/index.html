{{ define "title" }}管理后台{{ end }}

{{ define "body" }}
<div class="min-h-screen bg-[#F2F2F7]" x-data="adminPanel()" x-init="init()">
    <!-- 顶部导航栏 -->
    <nav class="bg-white/90 backdrop-blur-xl border-b border-[#E5E5EA] sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-14 sm:h-16">
                <!-- 移动端菜单按钮 -->
                <button @click="sidebarOpen = !sidebarOpen" class="lg:hidden p-2 -ml-2 rounded-lg text-[#8E8E93] hover:bg-[#E5E5EA] transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                <h1 class="text-[17px] sm:text-[20px] font-semibold text-[#1C1C1E]">管理后台</h1>
                <button @click="logout"
                    class="text-[14px] sm:text-[15px] text-[#FF3B30] font-medium px-3 py-1.5 rounded-lg hover:bg-[#FF3B30]/10 transition-all duration-150 active:opacity-60">
                    退出登录
                </button>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto flex">
        <!-- 侧边栏 - PC端 -->
        <aside class="hidden lg:block w-64 shrink-0 sticky top-16 h-[calc(100vh-4rem)] overflow-y-auto border-r border-[#E5E5EA] bg-white/50">
            <nav class="p-4 space-y-2">
                <button @click="activeTab = 'config'"
                    :class="activeTab === 'config' ? 'bg-[#885021] text-white' : 'text-[#1C1C1E] hover:bg-[#E5E5EA]'"
                    class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-[15px] font-medium transition-all duration-150">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    系统配置
                </button>
                <button @click="activeTab = 'announcements'"
                    :class="activeTab === 'announcements' ? 'bg-[#885021] text-white' : 'text-[#1C1C1E] hover:bg-[#E5E5EA]'"
                    class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-[15px] font-medium transition-all duration-150">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"></path>
                    </svg>
                    公告管理
                </button>
            </nav>
        </aside>

        <!-- 移动端侧边栏遮罩 -->
        <div x-show="sidebarOpen" @click="sidebarOpen = false"
            class="fixed inset-0 bg-black/40 z-40 lg:hidden"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-150"
            x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            x-cloak></div>

        <!-- 移动端侧边栏 -->
        <aside x-show="sidebarOpen"
            class="fixed left-0 top-0 bottom-0 w-72 bg-white z-50 lg:hidden shadow-2xl"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="-translate-x-full"
            x-transition:enter-end="translate-x-0"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="translate-x-0"
            x-transition:leave-end="-translate-x-full"
            x-cloak>
            <div class="p-4 border-b border-[#E5E5EA] flex justify-between items-center">
                <h2 class="text-[17px] font-semibold text-[#1C1C1E]">菜单</h2>
                <button @click="sidebarOpen = false" class="p-2 rounded-lg text-[#8E8E93] hover:bg-[#E5E5EA]">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <nav class="p-4 space-y-2">
                <button @click="activeTab = 'config'; sidebarOpen = false"
                    :class="activeTab === 'config' ? 'bg-[#885021] text-white' : 'text-[#1C1C1E] hover:bg-[#E5E5EA]'"
                    class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-[15px] font-medium transition-all duration-150">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    系统配置
                </button>
                <button @click="activeTab = 'announcements'; sidebarOpen = false"
                    :class="activeTab === 'announcements' ? 'bg-[#885021] text-white' : 'text-[#1C1C1E] hover:bg-[#E5E5EA]'"
                    class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-[15px] font-medium transition-all duration-150">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"></path>
                    </svg>
                    公告管理
                </button>
            </nav>
        </aside>

        <!-- 主内容区 -->
        <main class="flex-1 min-w-0 p-4 sm:p-6 lg:p-8">
            <!-- 系统配置 -->
            <div x-show="activeTab === 'config'" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
                <div class="mb-6">
                    <h2 class="text-[20px] sm:text-[24px] font-semibold text-[#1C1C1E]">系统配置</h2>
                    <p class="text-[14px] text-[#8E8E93] mt-1">管理站点访问权限和密码设置</p>
                </div>

                <!-- 配置网格 - PC端双列，移动端单列 -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
                    <!-- 访问控制卡片 -->
                    <div class="bg-white rounded-2xl overflow-hidden shadow-sm">
                        <div class="px-4 sm:px-6 py-4 border-b border-[#E5E5EA]">
                            <h3 class="text-[16px] font-semibold text-[#1C1C1E]">访问控制</h3>
                        </div>
                        <div class="p-4 sm:p-6 space-y-5">
                            <!-- 访问验证开关 -->
                            <div class="flex items-center justify-between">
                                <div>
                                    <span class="text-[15px] text-[#1C1C1E] font-medium">开启访问验证</span>
                                    <p class="text-[13px] text-[#8E8E93] mt-0.5">启用后用户需输入密码才能访问</p>
                                </div>
                                <div class="w-[51px] h-[31px] rounded-full relative transition-colors duration-250 cursor-pointer shrink-0 ml-4"
                                    :class="config.site_access_enabled ? 'bg-[#885021]' : 'bg-[#E5E5EA]'"
                                    @click="config.site_access_enabled = !config.site_access_enabled; updateConfig()">
                                    <div class="w-[27px] h-[27px] bg-white rounded-full absolute top-[2px] shadow transition-transform duration-250"
                                        :class="config.site_access_enabled ? 'translate-x-[22px]' : 'translate-x-[2px]'"></div>
                                </div>
                            </div>

                            <!-- 访问密码 -->
                            <div>
                                <label class="block text-[13px] text-[#8E8E93] mb-2">访问密码</label>
                                <div class="flex gap-2 sm:gap-3">
                                    <div class="relative flex-1 min-w-0">
                                        <input :type="showSitePassword ? 'text' : 'password'" x-model="newSitePassword" placeholder="输入新密码"
                                            class="w-full bg-[#F2F2F7] border-none rounded-xl px-3 sm:px-4 py-2.5 sm:py-3 text-[15px] text-[#1C1C1E] placeholder-[#C7C7CC] focus:bg-white focus:ring-2 focus:ring-[#885021]/20 focus:outline-none transition-all duration-200 pr-10">
                                        <button type="button" @click="showSitePassword = !showSitePassword"
                                            class="absolute right-3 top-1/2 -translate-y-1/2 text-[#8E8E93] hover:text-[#1C1C1E] transition-colors focus:outline-none"
                                            title="显示/隐藏密码">
                                            <svg x-show="!showSitePassword" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                            </svg>
                                            <svg x-show="showSitePassword" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88" />
                                            </svg>
                                        </button>
                                    </div>
                                    <button @click="updateSitePassword"
                                        class="bg-[#885021] text-white px-4 sm:px-5 py-2.5 sm:py-3 rounded-xl text-[15px] font-medium transition-all duration-150 hover:bg-[#6D4019] active:bg-[#5D3615] active:scale-[0.98] whitespace-nowrap">
                                        更新
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 管理员设置卡片 -->
                    <div class="bg-white rounded-2xl overflow-hidden shadow-sm">
                        <div class="px-4 sm:px-6 py-4 border-b border-[#E5E5EA]">
                            <h3 class="text-[16px] font-semibold text-[#1C1C1E]">管理员设置</h3>
                        </div>
                        <div class="p-4 sm:p-6">
                            <div>
                                <label class="block text-[13px] text-[#8E8E93] mb-2">管理员密码</label>
                                <p class="text-[13px] text-[#8E8E93] mb-3">用于登录管理后台</p>
                                <div class="flex gap-2 sm:gap-3">
                                    <div class="relative flex-1 min-w-0">
                                        <input :type="showAdminPassword ? 'text' : 'password'" x-model="newAdminPassword" placeholder="输入新密码"
                                            class="w-full bg-[#F2F2F7] border-none rounded-xl px-3 sm:px-4 py-2.5 sm:py-3 text-[15px] text-[#1C1C1E] placeholder-[#C7C7CC] focus:bg-white focus:ring-2 focus:ring-[#885021]/20 focus:outline-none transition-all duration-200 pr-10">
                                        <button type="button" @click="showAdminPassword = !showAdminPassword"
                                            class="absolute right-3 top-1/2 -translate-y-1/2 text-[#8E8E93] hover:text-[#1C1C1E] transition-colors focus:outline-none"
                                            title="显示/隐藏密码">
                                            <svg x-show="!showAdminPassword" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                            </svg>
                                            <svg x-show="showAdminPassword" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88" />
                                            </svg>
                                        </button>
                                    </div>
                                    <button @click="updateAdminPassword"
                                        class="bg-[#885021] text-white px-4 sm:px-5 py-2.5 sm:py-3 rounded-xl text-[15px] font-medium transition-all duration-150 hover:bg-[#6D4019] active:bg-[#5D3615] active:scale-[0.98] whitespace-nowrap">
                                        更新
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 公告管理 -->
            <div x-show="activeTab === 'announcements'" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-6">
                    <div>
                        <h2 class="text-[20px] sm:text-[24px] font-semibold text-[#1C1C1E]">公告管理</h2>
                        <p class="text-[14px] text-[#8E8E93] mt-1">管理站点公告信息</p>
                    </div>
                    <button @click="showAddModal = true"
                        class="inline-flex items-center justify-center gap-2 bg-[#885021] text-white px-4 sm:px-5 py-2.5 sm:py-3 rounded-xl text-[15px] font-medium transition-all duration-150 hover:bg-[#6D4019] active:bg-[#5D3615] active:scale-[0.98]">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        添加公告
                    </button>
                </div>

                <!-- 公告列表 - PC端网格，移动端列表 -->
                <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                    <template x-for="a in announcements" :key="a.id">
                        <div class="bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-200">
                            <div class="p-4 sm:p-5">
                                <!-- 标题和标签 -->
                                <div class="flex items-start justify-between gap-3 mb-3">
                                    <h3 class="text-[16px] font-semibold text-[#1C1C1E] line-clamp-1" x-text="a.title"></h3>
                                    <div class="flex items-center gap-1.5 shrink-0">
                                        <span class="text-[11px] px-2 py-0.5 rounded-full font-medium"
                                            :class="{
                                                'bg-[#007AFF]/10 text-[#007AFF]': a.type === 'info',
                                                'bg-[#FF9500]/10 text-[#FF9500]': a.type === 'warning',
                                                'bg-[#FF3B30]/10 text-[#FF3B30]': a.type === 'error'
                                            }" x-text="a.type === 'info' ? '信息' : (a.type === 'warning' ? '警告' : '错误')"></span>
                                        <span class="text-[11px] px-2 py-0.5 rounded-full font-medium"
                                            :class="a.is_active ? 'bg-[#34C759]/10 text-[#34C759]' : 'bg-[#8E8E93]/10 text-[#8E8E93]'"
                                            x-text="a.is_active ? '启用' : '禁用'"></span>
                                    </div>
                                </div>
                                <!-- 内容 -->
                                <p class="text-[14px] text-[#8E8E93] line-clamp-2 mb-4" x-text="a.content"></p>
                                <!-- 操作按钮 -->
                                <div class="flex items-center gap-2 pt-3 border-t border-[#E5E5EA]">
                                    <button @click="editAnnouncement(a)"
                                        class="flex-1 text-[14px] text-[#007AFF] font-medium py-2 rounded-lg hover:bg-[#007AFF]/10 transition-colors">
                                        编辑
                                    </button>
                                    <div class="w-px h-5 bg-[#E5E5EA]"></div>
                                    <button @click="deleteAnnouncement(a.id)"
                                        class="flex-1 text-[14px] text-[#FF3B30] font-medium py-2 rounded-lg hover:bg-[#FF3B30]/10 transition-colors">
                                        删除
                                    </button>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- 空状态 -->
                <div x-show="announcements.length === 0" class="bg-white rounded-2xl p-8 sm:p-12 text-center">
                    <svg class="w-16 h-16 mx-auto text-[#C7C7CC] mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"></path>
                    </svg>
                    <p class="text-[16px] text-[#8E8E93] mb-4">暂无公告</p>
                    <button @click="showAddModal = true"
                        class="inline-flex items-center gap-2 text-[#885021] font-medium hover:underline">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        添加第一个公告
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- 添加/编辑公告弹窗 -->
    <div x-show="showAddModal || editingAnnouncement"
        class="fixed inset-0 bg-black/50 flex items-end sm:items-center justify-center p-0 sm:p-4 z-50"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        x-cloak>
        <div class="bg-white rounded-t-3xl sm:rounded-2xl p-5 sm:p-6 w-full sm:max-w-md max-h-[90vh] overflow-y-auto"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 translate-y-full sm:translate-y-0 sm:scale-95"
            x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
            x-transition:leave-end="opacity-0 translate-y-full sm:translate-y-0 sm:scale-95"
            @click.outside="closeModal()">
            <!-- 移动端拖拽指示器 -->
            <div class="sm:hidden w-10 h-1 bg-[#E5E5EA] rounded-full mx-auto mb-4"></div>

            <h3 class="text-[18px] sm:text-[20px] font-semibold text-[#1C1C1E] mb-5"
                x-text="editingAnnouncement ? '编辑公告' : '添加公告'"></h3>

            <div class="space-y-4">
                <div>
                    <label class="block text-[13px] font-medium text-[#1C1C1E] mb-2">标题</label>
                    <input type="text" x-model="form.title" placeholder="请输入公告标题"
                        class="w-full bg-[#F2F2F7] border-none rounded-xl px-4 py-3 text-[15px] text-[#1C1C1E] placeholder-[#C7C7CC] focus:bg-white focus:ring-2 focus:ring-[#885021]/20 focus:outline-none transition-all duration-200">
                </div>

                <div>
                    <label class="block text-[13px] font-medium text-[#1C1C1E] mb-2">内容</label>
                    <textarea x-model="form.content" placeholder="请输入公告内容" rows="4"
                        class="w-full bg-[#F2F2F7] border-none rounded-xl px-4 py-3 text-[15px] text-[#1C1C1E] placeholder-[#C7C7CC] focus:bg-white focus:ring-2 focus:ring-[#885021]/20 focus:outline-none transition-all duration-200 resize-none"></textarea>
                </div>

                <div>
                    <label class="block text-[13px] font-medium text-[#1C1C1E] mb-2">类型</label>
                    <select x-model="form.type"
                        class="w-full bg-[#F2F2F7] border-none rounded-xl px-4 py-3 text-[15px] text-[#1C1C1E] focus:bg-white focus:ring-2 focus:ring-[#885021]/20 focus:outline-none transition-all duration-200">
                        <option value="info">信息</option>
                        <option value="warning">警告</option>
                        <option value="error">错误</option>
                    </select>
                </div>

                <div class="flex items-center justify-between py-2">
                    <span class="text-[15px] text-[#1C1C1E]">启用公告</span>
                    <div class="w-[51px] h-[31px] rounded-full relative transition-colors duration-250 cursor-pointer"
                        :class="form.is_active ? 'bg-[#885021]' : 'bg-[#E5E5EA]'"
                        @click="form.is_active = !form.is_active">
                        <div class="w-[27px] h-[27px] bg-white rounded-full absolute top-[2px] shadow transition-transform duration-250"
                            :class="form.is_active ? 'translate-x-[22px]' : 'translate-x-[2px]'"></div>
                    </div>
                </div>
            </div>

            <div class="flex gap-3 mt-6">
                <button @click="closeModal()"
                    class="flex-1 bg-[#E5E5EA] text-[#1C1C1E] py-3 rounded-xl text-[15px] font-medium transition-all duration-150 hover:bg-[#D1D1D6] active:bg-[#C7C7CC]">
                    取消
                </button>
                <button @click="saveAnnouncement()"
                    class="flex-1 bg-[#885021] text-white py-3 rounded-xl text-[15px] font-semibold transition-all duration-150 hover:bg-[#6D4019] active:bg-[#5D3615] active:scale-[0.98]">
                    保存
                </button>
            </div>
        </div>
    </div>
</div>
{{ end }}

{{ define "scripts" }}
<script>
function adminPanel() {
    return {
        config: { site_access_enabled: false },
        newSitePassword: '',
        showSitePassword: false,
        newAdminPassword: '',
        showAdminPassword: false,
        announcements: [],
        showAddModal: false,
        editingAnnouncement: null,
        form: { title: '', content: '', type: 'info', is_active: true },
        sidebarOpen: false,
        activeTab: 'config',

        async init() {
            await this.loadConfig();
            await this.loadAnnouncements();
        },

        async loadConfig() {
            try {
                const res = await axios.get('/api/v1/admin/config');
                this.config = res.data.data;
            } catch (e) {}
        },

        async loadAnnouncements() {
            try {
                const res = await axios.get('/api/v1/admin/announcements');
                this.announcements = res.data.data || [];
            } catch (e) {}
        },

        async updateConfig() {
            await axios.post('/api/v1/admin/config/update', { site_access_enabled: this.config.site_access_enabled });
        },

        async updateSitePassword() {
            if (!this.newSitePassword) return;
            await axios.post('/api/v1/admin/config/update', { site_access_password: this.newSitePassword });
            this.newSitePassword = '';
            alert('访问密码已更新');
        },

        async updateAdminPassword() {
            if (!this.newAdminPassword) return;
            await axios.post('/api/v1/admin/config/update', { admin_password: this.newAdminPassword });
            this.newAdminPassword = '';
            alert('管理员密码已更新');
        },

        editAnnouncement(a) {
            this.editingAnnouncement = a;
            this.form = { ...a };
        },

        closeModal() {
            this.showAddModal = false;
            this.editingAnnouncement = null;
            this.form = { title: '', content: '', type: 'info', is_active: true };
        },

        async saveAnnouncement() {
            if (this.editingAnnouncement) {
                await axios.post('/api/v1/admin/announcements/' + this.editingAnnouncement.id + '/update', this.form);
            } else {
                await axios.post('/api/v1/admin/announcements', this.form);
            }
            this.closeModal();
            await this.loadAnnouncements();
        },

        async deleteAnnouncement(id) {
            if (!confirm('确定删除该公告？')) return;
            await axios.post('/api/v1/admin/announcements/' + id + '/delete');
            await this.loadAnnouncements();
        },

        async logout() {
            await axios.post('/api/v1/admin/logout');
            window.location.href = '/admin/login';
        }
    }
}
</script>
{{ end }}
