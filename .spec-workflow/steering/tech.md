# 技术栈

## 项目类型

Web API 服务 + 内嵌前端的单体应用

## 核心技术

### 主要语言

- **语言**: Go 1.18+（使用泛型特性）
- **模块管理**: Go Modules

### 核心依赖

| 依赖 | 用途 | 版本要求 |
|------|------|---------|
| **Gin** | Web 框架，路由和中间件 | 最新稳定版 |
| **Resty** | HTTP 客户端，请求教务系统 | 最新稳定版 |
| **goquery** | HTML 解析，jQuery 风格选择器 | 最新稳定版 |
| **slog + tint** | 日志输出，彩色控制台 | Go 1.21+ 标准库 |
| **lumberjack** | 日志切割，自动压缩归档 | 最新稳定版 |

### 应用架构

采用极简分层架构（Minimalist Layered Architecture）：

```
main.go          → 入口层：路由注册、静态资源、启动
middleware/      → 中间件层：CORS、鉴权、日志
api/v1/          → 接口层：参数绑定、调用 Service、响应
service/         → 业务层：HTTP 客户端、爬虫、HTML 解析
model/           → 模型层：结构体、请求参数、响应结构
common/          → 公共层：统一响应、日志、请求工具
```

### 数据存储

- **无数据库**: 所有数据来自教务系统实时爬取
- **数据格式**: JSON（API 输入输出）

### 外部集成

- **目标系统**: 曲阜师范大学教务系统
- **通信协议**: HTTP/HTTPS
- **认证方式**: Cookie-based（通过 Authorization Header 传递）

## 开发环境

### 构建与开发工具

- **构建系统**: `go build`，支持交叉编译
- **热重载**: Air（开发时自动重启）
- **配置文件**: `.air.toml`

### 代码质量工具

- **格式化**: `go fmt`
- **静态检查**: `go vet`
- **测试框架**: Go 标准测试库

### 版本控制

- **VCS**: Git
- **分支策略**: 主分支开发
- **代码规范**: Go 官方规范

## 部署与分发

- **目标平台**: Linux/Windows/macOS（支持交叉编译）
- **分发方式**: 单一二进制文件，`scp` 直接部署
- **静态资源**: 使用 `go:embed` 编译嵌入
- **运行要求**: 无外部依赖，开箱即用

## 技术要求与约束

### 性能要求

- 单次 API 请求响应时间取决于教务系统响应速度
- 内存占用低，适合小型服务器运行

### 兼容性要求

- **Go 版本**: 1.18+（泛型支持）
- **操作系统**: Linux、Windows、macOS
- **架构**: amd64、arm64

### 安全考虑

- Cookie 通过 Authorization Header 传递，不存储于服务端
- 支持 CORS 配置
- 请求日志脱敏处理

## 技术决策记录

### 决策 1：选择 Gin 框架

- **原因**: 性能优秀、生态成熟、学习曲线平缓
- **备选**: Echo、Fiber
- **权衡**: Gin 社区最活跃，文档最完善

### 决策 2：使用 Resty 作为 HTTP 客户端

- **原因**: 链式调用、响应拦截器、易于调试
- **备选**: 标准库 net/http
- **权衡**: Resty 代码更简洁，减少样板代码

### 决策 3：使用 embed 嵌入前端资源

- **原因**: 单文件部署，简化运维
- **备选**: 独立部署前端
- **权衡**: 牺牲前端独立更新能力，换取部署便捷性

### 决策 4：不使用 ORM 和数据库

- **原因**: 项目不需要持久化存储，所有数据实时获取
- **权衡**: 如需缓存可考虑引入 Redis

## 已知限制

1. **依赖教务系统**: 教务系统变更可能导致爬虫失效
2. **无缓存**: 每次请求都需要实时爬取，响应速度受限
3. **单实例**: 未设计分布式部署方案
4. **无自动测试**: 爬虫类项目难以编写稳定的自动化测试
